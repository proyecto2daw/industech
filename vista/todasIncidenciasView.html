
{% extends "index.html" %}

{% block content %}




<section class="col-10">
    <div>
        <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#filtro" aria-expanded="false" aria-controls="filtro">
            Filtro
        </button>
    </div>
    <div class="collapse" id="filtro" style="margin-top: 10px">
        <div class="card card-body">
            <!--prueba -->
            <form method="POST" action="index.php?controller=incidencia&action=filtroIncidencias">
                <div class="form-group row">                    
                    <label for="inputTecnicoFiltro" class="col-sm-1 offset-1 col-form-label">TÃ©cnico</label>
                    <div class="col col-sm-3">
                        <select name="tecnico" class="form-control camposFormModificar" id="inputTecnicoFiltro" >
                            <option value="">Seleccione opcion</option>
                            {% for tecnico in datos.tecnicos %}
                            <option value="{{tecnico.idUsuario}}">{{tecnico.nombre}}</option>
                            {%endfor%}
                        </select>
                    </div>
                    <label for="inputCategoriaFiltro" class="col-sm-1 offset-1 col-form-label">Categoria</label>
                    <div class="col col-sm-3">
                        <select name="categoria" class="form-control camposFormModificar" id="inputCategoriaFiltro" >
                            <option value="">Seleccione opcion</option>
                            {% for categoria in datos.categorias %}
                            <option value="{{categoria.idCategoria}}">{{categoria.nombre}}</option>
                            {%endfor%} 
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="inputEstadoFiltro" class="col-sm-1 offset-1 col-form-label">Estado</label>
                    <div class="col col-sm-3">
                        <select name="estado" class="form-control" id="inputEstadoFiltro" >
                            <option value="">Seleccione opcion</option>
                            <option value="0">Realizado</option>
                            <option value="1">No realizado</option>
                        </select>
                    </div>
                    <label for="inputPrioridadFiltro" class="col-sm-1  offset-1 col-form-label">Prioridad</label>
                    <div class="col col-sm-3">
                        <select name="prioridad" class="form-control" id="inputPrioridadFiltro" >
                            <option value="">Seleccione opcion</option>
                            <option value="0">Baja</option>
                            <option value="1">Media</option>
                            <option value="2">Alta</option>
                            <option value="3">Urgente</option>
                        </select>
                    </div>
                </div>
                <div class="form-group row">                    
                    <label for="fechaInicial" class="col-sm-1 offset-1 col-form-label" >Fecha Inicial</label>
                    <div class="col-sm-3">
                        <input type="date" class="form-control" id="fechaInicial" name="fechaInicial">
                    </div>
                    <label for="fechaFinal" class="col-sm-1 offset-1 col-form-label">Fecha Final</label>
                    <div class="col-sm-3">
                        <input type="date" class="form-control" id="fechaFinal" name="fechaFinal" >
                    </div>
                </div>

                <div class="form-group row">                 
                    <label for="nombreEmpresaFiltro" class="col-sm-1 offset-1 col-form-label">Empresa</label>
                    <div class="col col-sm-3">
                        <select class="form-control" id="nombreEmpresaFiltro" name="empresa">
                            <option value="">Seleccione opcion</option>
                            {% for empresa in datos.empresas %}
                            <option value="{{empresa.idEmpresa}}">{{empresa.nombre}}</option>
                            {%endfor%} 
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Buscar</button>

            </form>  <!-- fin: prueba -->


        </div>


    </div>
    <div class="row">
        
        <div class='offset-1'></div>
    <table class="table table-hover table-responsive col-10"  id="todasIncidenciasTable" style="margin:0 auto;" >
        <thead class="thead-dark colorfondo">
            <tr>
                <th scope="col">Titulo</th>
                <th scope="col" class="hidden-sm">Descripcion</th>
                <th scope="col">Fecha</th>
                <th scope="col">Categoria</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody >
         {% for incidencia in datos.incidencias %}
            <tr>
                <th scope="row">{{incidencia.titulo}}</th>
                <td class="hidden-sm">{{incidencia.descripcion}}</td>
                <td>{{incidencia.fecha}}</td>
                <td>{{incidencia.nombreCategoria}}</td>
                <td class="d-flex justify-content-end">
                    <a  href="index.php?controller=incidencia&action=ver&id={{incidencia.idIncidencia}}" title="ver incidencia" >
                        <button class="btn btn-info">
                            <i class="fa fa-eye"></i>
                        </button>
                    </a>
                    &nbsp;
                    {%if incidencia.tecnico==datos.yo%}
                    <button class="btn btn-primary borrar" title="cerrar incidencia" value="{{incidencia.idIncidencia}}">
                        <i class="fas fa-lock"></i>
                    </button>
                   &nbsp;
                    <button class="btn btn-danger borrar" title="borrar incidencia" value="{{incidencia.idIncidencia}}">
                        <i class="fas fa-trash-alt"></i>
                    </button> 
                    {%else%}
                    <button class="btn btn-secondary borrar" title="cerrar incidencia" value="{{incidencia.idIncidencia}}" disabled="disabled">
                        <i class="fas fa-lock"></i>
                    </button>
                   &nbsp;
                    <button class="btn btn-secondary borrar" title="borrar incidencia" value="{{incidencia.idIncidencia}}" disabled="disabled">
                        <i class="fas fa-trash-alt"></i>
                    </button> 
                    {%endif%}
                </td> 
            </tr>
            {%endfor%}
        </tbody>
    </table>
    </div>
</section>

<script type="text/javascript">

    $(document).ready(function(){    
       
    $('#todasIncidenciasTable').DataTable(
            {
                responsive:true,
        
  "lengthMenu": [ 15,10,5]

        
            });
});
</script>
{%endblock%}
